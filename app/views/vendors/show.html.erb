<h1 class='pg-header'><%= @vendor.name %></h1>

<h2 class='pg-sub-header'>Products</h2>

<table>
  <% @vendor.products.each do |product| %>
    <tr>
      <td><%= product.name %></td>
      <td><%= button_to 'Edit', edit_vendor_product_path(vendor_id: product.vendor_id, id: product.id ), method: :get %></td>
      <td><%= button_to 'Delete', product, method: :delete %></td>
      <td><%= button_to 'Add sale', new_product_sale_path(product_id: product.id), method: :get %></td>
    </tr>
  <% end %>
</table>


<%= link_to "Add new product", new_vendor_product_path(vendor_id: params[:id]), class: 'larger_nav_button' %><br><Br>

<h2 class='pg-sub-header'>Sales</h2>

<div>
  <%= link_to 'Ascending', vendor_path(order: 'asc') %>
  <%= link_to 'Descending', vendor_path(order: 'desc') %>
</div>

<table class='table_list'>
  <% total_sales = 0 %>
  <!-- <% @vendor.products.each do |product| %>
    <% product.sales.each do |sale| %>
      <% total_sales += sale.amount %>
      <tr>
        <td>$<%= p '%.2f' % (sale.amount/100.0) %></td><td><%= sale.purchase_time.strftime("%D") %></td>
      </tr>
    <% end %>
  <% end %> -->
  <% @sales.each do |sale| %>
    <% total_sales += sale.amount %>
    <tr>
      <td>$<%= p '%.2f' % (sale.amount/100.0) %></td><td><%= sale.purchase_time.strftime("%D") %></td>
    </tr>
  <% end %>
  <tr>
    <td>Total: $<%= p '%.2f' % (total_sales/100.0) %></td>
  </tr>
</table>

<h2>Current Month Sales</h2>

<table>
  <% total_sales = 0 %>
  <% @vendor.products.each do |product| %>
    <% product.sales.each do |sale| %>
      <% if sale.purchase_time.month == Time.now.month && sale.purchase_time.year == Time.now.year %>
        <% total_sales += sale.amount %>
        <tr>
          <td>$<%= p '%.2f' % (sale.amount/100.0) %></td><td><%= sale.purchase_time.strftime("%D") %></td>
        </tr>
      <% end %>
    <% end %>
  <% end %>
  <tr>
    <td>Total: $<%= p '%.2f' % (total_sales/100.0) %></td>
  </tr>
</table>

<div class='one_button_nav'>
  <%= link_to 'Return to Vendors', vendors_path, method: :get, class: "larger_nav_button" %>
</div>
